CREATE SCHEMA IF NOT EXISTS `happyhouse2` DEFAULT CHARACTER SET UTF8 ;
USE happyhouse2;

CREATE TABLE if NOT EXISTS sido(
sido_code INT NOT NULL PRIMARY KEY,
sido_name VARCHAR(20) NOT NULL)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE if NOT EXISTS gu(
gu_code INT not null,
gu_name VARCHAR(20) NOT NULL,
sido_code int NOT NULL,
PRIMARY KEY (gu_code, gu_name),
FOREIGN KEY (sido_code) REFERENCES sido(sido_code) ON DELETE CASCADE ON UPDATE CASCADE) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE if NOT EXISTS dong(
dong_code INT PRIMARY KEY NOT NULL,
dong_name VARCHAR(20) NOT NULL,
gu_code INT NOT NULL,
sido_code INT NOT NULL,
FOREIGN KEY (sido_code) REFERENCES sido(sido_code) ON delete CASCADE ON UPDATE CASCADE,
FOREIGN KEY (gu_code) REFERENCES gu(gu_code) ON delete CASCADE ON UPDATE CASCADE) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE if NOT EXISTS member(
CODE INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
id VARCHAR(30) NOT NULL UNIQUE,
pw VARCHAR(30) NOT NULL,
email VARCHAR(60) NOT NULL unique,
mname VARCHAR(30) NOT NULL,
reg_date DATE DEFAULT NULL,
is_admin TINYINT(1) DEFAULT 0,
location_code INT NOT null,
profile_code INT,
phone varchar(45),
prefer CHAR(3),
FOREIGN KEY (location_code) REFERENCES gu(gu_code) ON DELETE CASCADE ON UPDATE CASCADE) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE if NOT EXISTS profile_image(
code INT NOT NULL PRIMARY key auto_increment,
filename VARCHAR(50) NOT NULL,
filesize DOUBLE NOT NULL,
fileURL VARCHAR(200) NOT NULL,
content_type VARCHAR(20) NOT NULL,
FOREIGN KEY (code) REFERENCES member(CODE) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE if NOT EXISTS apart(
CODE INT PRIMARY KEY NOT NULL,
NAME VARCHAR(50) NOT NULL,
jibun VARCHAR(20) NOT NULL,
lat DOUBLE,
lng DOUBLE,
buildyear INT NOT NULL,
dong_code INT NOT NULL,
FOREIGN KEY (dong_code) REFERENCES dong(dong_code) ON DELETE CASCADE ON UPDATE CASCADE)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT EXISTS deal(
CODE INT PRIMARY KEY,
FLOOR INT NOT NULL,
AREA DOUBLE NOT NULL,
TYPE TINYINT(1) NOT NULL,
apart_code INT NOT null,
FOREIGN KEY (apart_code) REFERENCES apart(CODE))ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT EXISTS deal_detail(
CODE INT NOT NULL,
dealyear INT NOT NULL,
dealmonth INT NOT NULL,
dealday INT NOT NULL,
dealAmount VARCHAR(20) NOT NULL,
FOREIGN KEY (code) REFERENCES deal(code) ON DELETE CASCADE ON UPDATE CASCADE
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT EXISTS member_deal(
member_code INT NOT NULL ,
deal_code INT,
like_point INT DEFAULT 0,
look_date date DEFAULT NULL,
PRIMARY KEY (member_code, deal_code),
FOREIGN KEY (member_code) REFERENCES member(CODE) ON DELETE CASCADE ON UPDATE cascade,
FOREIGN KEY (deal_code) REFERENCES deal(CODE) ON DELETE CASCADE ON UPDATE CASCADE) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT EXISTS group_code(
group_code INT NOT NULL PRIMARY key,
group_name VARCHAR(20))ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT EXISTS CODE(
group_code INT NOT NULL,
code CHAR(3) NOT NULL DEFAULT '',
about VARCHAR(20) NOT NULL,
PRIMARY KEY(group_code, CODE),
FOREIGN KEY (group_code) REFERENCES group_code(group_code) ON DELETE CASCADE ON UPDATE CASCADE)ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE if NOT exists interest(
	member_code INT ,
	gu_code INT NOT NULL,
	dong_code INT NOT NULL,
	FOREIGN KEY (member_code) REFERENCES member(code) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

